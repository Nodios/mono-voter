(this.webpackJsonpvoter=this.webpackJsonpvoter||[]).push([[0],{110:function(e,t,n){"use strict";n.r(t);var r,a=n(0),o=n.n(a),i=n(10),s=n.n(i),c=(n(86),n(16)),u=n(15),l=n(23),p=n(24),b=n(27),m=n(17),d=n(31),f=n(158),h=n(159),v=n(30),y=n(160),O=n(137),j=n(161),w=n(5),g=Object(m.observer)(r=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,"Welcome")}}]),t}(o.a.Component))||r,E=n(13),S=n.n(E),q=n(22),k=n(148),x=n(71),I=n(140),R=n(141),A=n(144),C=n(145),D=n(146),z=n(147),F=n(142),P=n(143),N=n(136),Q=n(52),U=[{name:"home",pattern:"/"},{name:"questions",pattern:"/questions"},{name:"admin",pattern:"/admin"}],_=new d.RouterState("notFound"),V=function e(){Object(c.a)(this,e),this.routerStore=new d.RouterStore(this,U,_),this.questionsStore=new Ie(this)},L=n(19),B=n(11),W=(n(57),n(6)),G=n(58),M=n.n(G);M.a.initializeApp({apiKey:"AIzaSyBjqj1Ge9e3lgX1q3MeZCm8UzjQLa9qCwI",authDomain:"voter-ccc7c.firebaseapp.com",databaseURL:"https://voter-ccc7c.firebaseio.com",projectId:"voter-ccc7c",storageBucket:"voter-ccc7c.appspot.com",messagingSenderId:"112218268129",appId:"1:112218268129:web:26e0a5cc6531ca010ef2a0",measurementId:"G-G0TSSSZ1GL"});var T,Y,J,Z,H,K,X,$,ee,te,ne,re,ae,oe,ie,se,ce,ue,le,pe,be,me,de,fe,he,ve,ye,Oe,je,we,ge,Ee=M.a,Se=0,qe=1,ke=2,xe=(T=W.action.bound,Y=W.action.bound,J=W.action.bound,Z=W.action.bound,H=function(){function e(){Object(c.a)(this,e),Object(L.a)(this,"questionState",K,this),Object(L.a)(this,"question",X,this),Object(L.a)(this,"questionRef",$,this),Object(L.a)(this,"step",ee,this),Object(L.a)(this,"answer",te,this),this._dbUnsubscriber=void 0,this._db=void 0,Object(L.a)(this,"castVote",ne,this)}return Object(u.a)(e,[{key:"init",value:function(e,t){var n=this;this.step=e,this.userId=t,this.answer=localStorage.getItem(this.step),this._dbUnsubscriber=Ee.firestore().collection("questions").where("sortOrder","==",e).limit(1).onSnapshot((function(e){if(1===e.size){n.questionRef=e.docs[0].ref;var r=e.docs[0].data();n.question=r,r.votes[t]||n.resetAnswer(),n.questionState=qe}else n.questionState=ke,n.question=null}))}},{key:"dispose",value:function(){this._dbUnsubscriber&&(this._dbUnsubscriber(),this._dbUnsubscriber=null,console.log("disposed"))}},{key:"resetAnswer",value:function(){this.answer=null,localStorage.removeItem(this.step)}},{key:"votesCount",get:function(){var e=this,t={total:0,yes:0,no:0};return this.question?Object.keys(this.question.votes).reduce((function(t,n){var r=e.question.votes[n];return t.total++,"yes"===r?t.yes++:"no"===r&&t.no++,t}),t):t}}]),e}(),K=Object(B.a)(H.prototype,"questionState",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Se}}),X=Object(B.a)(H.prototype,"question",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=Object(B.a)(H.prototype,"questionRef",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=Object(B.a)(H.prototype,"step",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te=Object(B.a)(H.prototype,"answer",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(B.a)(H.prototype,"votesCount",[W.computed],Object.getOwnPropertyDescriptor(H.prototype,"votesCount"),H.prototype),ne=Object(B.a)(H.prototype,"castVote",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e.answer!==t&&Ee.firestore().runTransaction((function(r){return r.get(e.questionRef).then((function(a){var o=a.data().votes;o[n]=t,r.update(e.questionRef,{votes:o}),e.answer=t,localStorage.setItem(e.step,t)}))}))}}}),Object(B.a)(H.prototype,"init",[Y],Object.getOwnPropertyDescriptor(H.prototype,"init"),H.prototype),Object(B.a)(H.prototype,"dispose",[J],Object.getOwnPropertyDescriptor(H.prototype,"dispose"),H.prototype),Object(B.a)(H.prototype,"resetAnswer",[Z],Object.getOwnPropertyDescriptor(H.prototype,"resetAnswer"),H.prototype),H),Ie=(re=W.action.bound,ae=function(){function e(t){Object(c.a)(this,e),Object(L.a)(this,"step",oe,this),Object(L.a)(this,"isAuthenticated",ie,this),Object(L.a)(this,"userId",se,this)}return Object(u.a)(e,[{key:"init",value:function(){var e=Object(q.a)(S.a.mark((function e(){var t,n=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.auth().signInAnonymously();case 2:t=e.sent,Object(W.runInAction)((function(){n.userId=t.user.uid,n.isAuthenticated=!0})),"k1UWLoF47u9t7jVu36aR",Ee.firestore().collection("steps").doc("k1UWLoF47u9t7jVu36aR").onSnapshot((function(e){var t=e.data();n.step=t.questionStep}),(function(e){console.log("ERROR",e)}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),oe=Object(B.a)(ae.prototype,"step",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ie=Object(B.a)(ae.prototype,"isAuthenticated",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),se=Object(B.a)(ae.prototype,"userId",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(B.a)(ae.prototype,"init",[re],Object.getOwnPropertyDescriptor(ae.prototype,"init"),ae.prototype),ae),Re={question:"",sortOrder:0},Ae=(ce=W.action.bound,ue=W.action.bound,le=W.action.bound,pe=W.action.bound,be=W.action.bound,me=W.action.bound,de=W.action.bound,fe=function(){function e(){var t=this;Object(c.a)(this,e),Object(L.a)(this,"step",he,this),Object(L.a)(this,"questions",ve,this),Object(L.a)(this,"form",ye,this),this._db=Ee.firestore(),this._stepRef=void 0,this.addQuestion=function(){var e=Object(q.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.firestore().collection("questions").doc();case 2:return n=e.sent,e.next=5,n.set({question:t.question,sortOrder:+t.sortOrder,votes:{}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.fetchQuestions=Object(q.a)(S.a.mark((function e(){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.questions=[],e.next=3,Ee.firestore().collection("questions").orderBy("sortOrder","asc").get();case 3:n=e.sent,Object(W.runInAction)((function(){n.forEach((function(e){t.questions.push(e.data())}))}));case 5:case"end":return e.stop()}}),e)})))}return Object(u.a)(e,[{key:"init",value:function(){var e=Object(q.a)(S.a.mark((function e(){var t=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.auth().signInAnonymously();case 2:return e.sent,this._stepRef=this._db.collection("steps").doc("k1UWLoF47u9t7jVu36aR"),this._stepRef.onSnapshot((function(e){var n=e.data();Object(W.runInAction)((function(){t.setStep(n.questionStep)}))})),e.next=7,this.fetchQuestions();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setQuestion",value:function(e){this.question=e}},{key:"setStep",value:function(e){this.step=e}},{key:"next",value:function(){var e=Object(q.a)(S.a.mark((function e(){var t,n,r,a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ee.firestore.FieldValue.increment(1),n=this.step,e.prev=2,e.next=5,this._stepRef.update({questionStep:t});case 5:return n++,e.next=8,this.fetchQuestion(n);case 8:r=e.sent,Object(W.runInAction)((function(){a.step=n,a.question=r})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"previous",value:function(){var e=Object(q.a)(S.a.mark((function e(){var t,n,r,a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.step>0)){e.next=15;break}return t=Ee.firestore.FieldValue.increment(-1),n=this.step,e.prev=3,e.next=6,this._stepRef.update({questionStep:t});case 6:return n--,e.next=9,this.fetchQuestion(n);case 9:r=e.sent,Object(W.runInAction)((function(){a.step=n,a.question=r})),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(3);case 15:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateField",value:function(e){var t=e.target,n=t.name,r=t.value;this.form[n]=r}},{key:"submit",value:function(){var e=Object(q.a)(S.a.mark((function e(t){var n=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,this.addQuestion(this.form);case 3:Object(W.runInAction)(Object(q.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.form=Re,e.next=3,n.fetchQuestions();case 3:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"displayStep",get:function(){return this.step+1}}]),e}(),he=Object(B.a)(fe.prototype,"step",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ve=Object(B.a)(fe.prototype,"questions",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ye=Object(B.a)(fe.prototype,"form",[W.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Re}}),Object(B.a)(fe.prototype,"displayStep",[W.computed],Object.getOwnPropertyDescriptor(fe.prototype,"displayStep"),fe.prototype),Object(B.a)(fe.prototype,"init",[ce],Object.getOwnPropertyDescriptor(fe.prototype,"init"),fe.prototype),Object(B.a)(fe.prototype,"setQuestion",[ue],Object.getOwnPropertyDescriptor(fe.prototype,"setQuestion"),fe.prototype),Object(B.a)(fe.prototype,"setStep",[le],Object.getOwnPropertyDescriptor(fe.prototype,"setStep"),fe.prototype),Object(B.a)(fe.prototype,"next",[pe],Object.getOwnPropertyDescriptor(fe.prototype,"next"),fe.prototype),Object(B.a)(fe.prototype,"previous",[be],Object.getOwnPropertyDescriptor(fe.prototype,"previous"),fe.prototype),Object(B.a)(fe.prototype,"updateField",[me],Object.getOwnPropertyDescriptor(fe.prototype,"updateField"),fe.prototype),Object(B.a)(fe.prototype,"submit",[de],Object.getOwnPropertyDescriptor(fe.prototype,"submit"),fe.prototype),fe),Ce=Object(x.a)({palette:{primary:N.a,secondary:Q.a}}),De=Object(m.inject)((function(e){return{viewStore:new xe}}))(Oe=Object(m.observer)(Oe=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.step,n=e.viewStore,r=e.userId;n.init(t,r)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.step,r=t.viewStore,a=t.userId;e.step!==n&&(r.dispose(),r.init(n,a))}},{key:"componentWillUnmount",value:function(){this.props.viewStore.dispose()}},{key:"render",value:function(){var e,t=this.props,n=t.classes,r=t.viewStore,a=t.userId,i=r.question,s=r.questionState,c=r.castVote,u=r.answer,l=r.votesCount;if(s<1)e=o.a.createElement("div",null,"Loading...");else if(s>1)e=o.a.createElement("div",null,"The end.");else{var p=l.yes/l.total*100||0,b=l.no/l.total*100||0;e=o.a.createElement(O.a,null,o.a.createElement("h3",null,i.question),o.a.createElement(I.a,{theme:Ce},o.a.createElement(R.a,{variant:"extended",size:"large",color:"primary","aria-label":"Yes",className:n.margin,disabled:"no"===u,onClick:function(e){return c("yes",a)}},o.a.createElement(F.a,{className:n.extendedIcon})," Yes"),o.a.createElement(R.a,{variant:"extended",size:"large",color:"secondary","aria-label":"Yes",className:n.margin,disabled:"yes"===u,onClick:function(e){return c("no",a)}},o.a.createElement(P.a,{className:n.extendedIcon})," No"),o.a.createElement("div",null,o.a.createElement(A.a,{className:n.card},o.a.createElement(C.a,{title:"Results"}),o.a.createElement(D.a,null,o.a.createElement(v.a,null,"Yes (",p.toFixed(0)," %)"),o.a.createElement(z.a,{color:"primary",variant:"determinate",value:p}),o.a.createElement(v.a,null,"No (",b.toFixed(0)," %)"),o.a.createElement(z.a,{color:"secondary",variant:"determinate",value:b}))))))}return e}}]),t}(o.a.Component))||Oe)||Oe,ze=Object(w.a)((function(e){return{margin:{margin:e.spacing(1)},fab:{selected:{color:"green"}},extendedIcon:{marginRight:e.spacing(2)},card:{marginTop:e.spacing(2)}}}))(De),Fe=Object(m.inject)((function(e){return{viewStore:e.rootStore.questionsStore}}))(je=Object(m.observer)(je=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(q.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.viewStore.init();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.viewStore,t=e.step,n=e.isAuthenticated,r=e.userId;return n?o.a.createElement(ze,{step:t,userId:r}):o.a.createElement("div",null,o.a.createElement(k.a,null))}}]),t}(o.a.Component))||je)||je,Pe=n(149),Ne=n(150),Qe=n(153),Ue=n(154),_e=n(155),Ve=n(157),Le=n(162),Be=n(151),We=n(152),Ge=n(156),Me=Object(m.inject)((function(e){return{viewStore:new Ae}}))(we=Object(m.observer)(we=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(q.a)(S.a.mark((function e(){return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.viewStore.init();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.viewStore,n=e.classes,r=t.step,a=(t.displayStep,t.next),i=t.previous,s=t.questions,c=t.form,u=t.updateField,l=t.submit;return o.a.createElement(O.a,null,o.a.createElement(A.a,{className:n.card},o.a.createElement(D.a,null,o.a.createElement(v.a,{variant:"h5",component:"h3"},"Admin page"))),o.a.createElement(A.a,{className:n.card},o.a.createElement(C.a,{title:"Questions management",subheader:"Use this to change question"}),o.a.createElement(Pe.a,null,o.a.createElement(Ne.a,{variant:"contained",color:"default",startIcon:o.a.createElement(Be.a,null),disabled:r<1,onClick:function(e){return i()}},"Previous question"),o.a.createElement(Ne.a,{variant:"contained",color:"default",endIcon:o.a.createElement(We.a,null),onClick:function(e){return a()}},"Next question"))),o.a.createElement(A.a,{className:n.card},o.a.createElement(C.a,{title:"List of questions"}),o.a.createElement(D.a,null,o.a.createElement(Qe.a,null,s.map((function(e,t){return o.a.createElement(Ue.a,{key:t},e.sortOrder===r&&o.a.createElement(_e.a,null,o.a.createElement(Ge.a,null)),o.a.createElement(Ve.a,{primary:e.question,secondary:"Sort order: "+e.sortOrder}))}))))),o.a.createElement(A.a,{className:n.card},o.a.createElement(C.a,{title:"Add new question"}),o.a.createElement(D.a,null,o.a.createElement("form",{onSubmit:l,noValidate:!0,autoComplete:"off"},o.a.createElement("div",null,o.a.createElement(Le.a,{required:!0,name:"question",label:"Question",margin:"normal",value:c.question,onChange:u})),o.a.createElement("div",null,o.a.createElement(Le.a,{required:!0,type:"number",name:"sortOrder",label:"Sort order",margin:"normal",value:c.sortOrder,onChange:u,inputProps:{min:1}}),o.a.createElement(Ne.a,{type:"submit"},"Add question"))))))}}]),t}(o.a.Component))||we)||we,Te=Object(w.a)((function(e){return{card:{marginTop:e.spacing(2),marginBottom:e.spacing(2)}}}))(Me),Ye={home:o.a.createElement(g,null),questions:o.a.createElement(Fe,null),admin:o.a.createElement(Te,null)},Je=Object(m.inject)((function(e){return{routerStore:e.rootStore.routerStore}}))(ge=Object(m.observer)(ge=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.classes;return o.a.createElement("div",{className:e.root},o.a.createElement(f.a,{position:"static"},o.a.createElement(h.a,null,o.a.createElement(v.a,{variant:"h6",className:e.title},o.a.createElement(y.a,{style:{fontFamily:"Monoton",fontSize:"30px",textShadow:"2px 2px #ccc",textDecoration:"none"},href:"/",color:"inherit"},"Voter")),o.a.createElement(y.a,{href:"/questions",color:"inherit"},"Quiz"))),o.a.createElement(O.a,{fixed:!0},o.a.createElement(j.a,{container:!0,justify:"center",alignContent:"center"},o.a.createElement(d.RouterView,{routerStore:this.props.routerStore,viewMap:Ye}))))}}]),t}(o.a.Component))||ge)||ge,Ze=Object(w.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}))(Je);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var He=n(72),Ke=Object(He.a)(),Xe=new V;new d.HistoryAdapter(Xe.routerStore,Ke).observeRouterStateChanges();var $e=Object(x.a)({fontFamily:"Roboto, sans-serif",palette:{primary:{main:"#DC3912"},secondary:{main:"#FF9900"}}});s.a.render(o.a.createElement(I.a,{theme:$e},o.a.createElement(m.Provider,{rootStore:Xe},o.a.createElement(Ze,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},81:function(e,t,n){e.exports=n(110)},86:function(e,t,n){}},[[81,1,2]]]);
//# sourceMappingURL=main.a292722f.chunk.js.map